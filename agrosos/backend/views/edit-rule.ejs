<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Rule</title>
</head>
<body>

<div class="edit-rule-form-container">
  <h2>Editar Regla</h2>
  <label for="cropId">Cultivo:</label>
  <select
    id="cropId"
    aria-label="Selecciona el cultivo"
  >
    <option value="">Selecciona un cultivo</option>
    <% crops.forEach(function(crop) { %>
      <option value="<%= crop.id %>" <%= cropId === crop.id ? 'selected' : '' %>><%= crop.name %></option>
    <% }) %>
  </select>

  <label for="sensorType">Sensor:</label>
<select
  id="sensorType"
  aria-label="Selecciona un sensor"
  onchange="handleSensorChange(event)"
>
  <option value="">Selecciona un sensor</option>
  <option value="Humedad" <%= sensorType === 'Humedad' ? 'selected' : '' %>>Humedad</option>
  <option value="Temperatura" <%= sensorType === 'Temperatura' ? 'selected' : '' %>>Temperatura</option>
  <option value="Humedad del terreno" <%= sensorType === 'Humedad del terreno' ? 'selected' : '' %>>Humedad del terreno</option>
  <option value="Temperatura del terreno" <%= sensorType === 'Temperatura del terreno' ? 'selected' : '' %>>Temperatura del terreno</option>
</select>


  <% if (sensorType === "Temperatura") { %>
    <div class="edit-rule-conditions">
      <h3>Condiciones de Temperatura</h3>
      <ul>
        <% temperatureConditions.forEach(function(cond, index) { %>
          <li>
            <%= cond.operator %> <%= cond.value %>°C
            <button
              class="delete-condition-button"
              onclick="handleDeleteCondition('temperature', <%= index %>)"
              aria-label="Eliminar condición de temperatura <%= cond.operator %> <%= cond.value %>°C"
            >
              Eliminar
            </button>
          </li>
        <% }) %>
      </ul>
      <button
        class="edit-rule-conditions-button"
        onclick="navigateTo('/temperature')"
        aria-label="Añadir condición de temperatura"
      >
        Añadir
      </button>
    </div>
  <% } %>

  <% if (sensorType === "Humedad") { %>
    <div class="edit-rule-conditions">
      <h3>Condiciones de Humedad</h3>
      <ul>
        <% humidityConditions.forEach(function(cond, index) { %>
          <li>
            <%= cond.operator %> <%= cond.value %>%
            <button
              class="delete-condition-button"
              onclick="handleDeleteCondition('humidity', <%= index %>)"
              aria-label="Eliminar condición de humedad <%= cond.operator %> <%= cond.value %>%"
            >
              Eliminar
            </button>
          </li>
        <% }) %>
      </ul>
      <button
        class="edit-rule-conditions-button"
        onclick="navigateTo('/humidity')"
        aria-label="Añadir condición de humedad"
      >
        Añadir
      </button>
    </div>
  <% } %>

  <% const actuatorActionMap = {
    'Riego': ['Activar Riego', 'Desactivar Riego'],
    'Ventilación': ['Activar Ventilación', 'Desactivar Ventilación'],
    'Cobertura de cultivos': ['Cubrir cultivos con lona semi-transparente', 'Cubrir cultivos con lona opaca', 'Destapar cultivos'],
    'Apertura de ventanas': ['Abrir ventanas', 'Cerrar ventanas']
  }; %>

  <label for="actuatorType">Actuador:</label>
  <select
    id="actuatorType"
    aria-label="Selecciona un actuador"
  >
    <option value="">Selecciona un actuador</option>
    <% Object.keys(actuatorActionMap).forEach(function(actuator) { %>
      <option value="<%= actuator %>" <%= actuatorType === actuator ? 'selected' : '' %>><%= actuator %></option>
    <% }) %>
  </select>

  <label for="selectedAction">Acción:</label>
  <select
    id="selectedAction"
    aria-label="Selecciona una acción"
  >
    <option value="">Selecciona una acción</option>
    <% (actuatorActionMap[actuatorType] || []).forEach(function(action) { %>
      <option value="<%= action %>" <%= selectedAction === action ? 'selected' : '' %>><%= action %></option>
    <% }) %>
  </select>

  <button
    class="edit-rule-update-button"
    onclick="handleUpdateRule()"
    aria-label="Actualizar la regla"
  >
    Actualizar Regla
  </button>
</div>

<script>
  const actuatorActionMap = {
    'Riego': ['Activar Riego', 'Desactivar Riego'],
    'Ventilación': ['Activar Ventilación', 'Desactivar Ventilación'],
    'Cobertura de cultivos': ['Cubrir cultivos con lona semi-transparente', 'Cubrir cultivos con lona opaca', 'Destapar cultivos'],
    'Apertura de ventanas': ['Abrir ventanas', 'Cerrar ventanas']
  };

  document.addEventListener('DOMContentLoaded', (event) => {
    const cropId = '<%= cropId %>';
    const sensorType = '<%= sensorType %>';
    const actuatorType = '<%= actuatorType %>';
    const selectedAction = '<%= typeof selectedAction !== "undefined" ? selectedAction : "" %>';

    document.getElementById('cropId').value = cropId;
    document.getElementById('sensorType').value = sensorType;
    document.getElementById('actuatorType').value = actuatorType;

    const actions = actuatorActionMap[actuatorType] || [];
    const selectedActionElement = document.getElementById('selectedAction');
    selectedActionElement.innerHTML = '<option value="">Selecciona una acción</option>';
    actions.forEach((action) => {
      const option = document.createElement('option');
      option.value = action;
      option.text = action;
      if (action === selectedAction) {
        option.selected = true;
      }
      selectedActionElement.appendChild(option);
    });
  });

  function handleCropChange(event) {
    // Actualizar el cultivo
  }

  function handleSensorChange(event) {
    const sensorType = event.target.value;
    document.getElementById('sensorType').value = sensorType;
    // Actualizar el sensor seleccionado
  }

  function handleActuatorChange(event) {
    const actuatorType = event.target.value;
    document.getElementById('actuatorType').value = actuatorType;
    const actions = actuatorActionMap[actuatorType] || [];
    const selectedActionElement = document.getElementById('selectedAction');
    selectedActionElement.innerHTML = '<option value="">Selecciona una acción</option>';
    actions.forEach((action) => {
      const option = document.createElement('option');
      option.value = action;
      option.text = action;
      selectedActionElement.appendChild(option);
    });
  }

  function handleActionChange(event) {
    document.getElementById('selectedAction').value = event.target.value;
  }

  function handleDeleteCondition(type, index) {
    // Lógica para eliminar la condición
  }

  function navigateTo(path) {
    window.location.href = path;
  }

  function handleUpdateRule() {
    // Lógica para actualizar la regla
  }
</script>

</body>
</html>
